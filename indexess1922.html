<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Transcription LPC</title>                                                                                                               
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #inputArea, #outputArea {
      margin-bottom: 20px;
    }
    #originalText {
      font-weight: bold;
      margin-bottom: 5px;
    }
    #phoneticText {
      font-style: italic;
      color: gray;
      margin-bottom: 10px;
    }
    #imageLine {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 5px;
    }
    img {
      height: 80px;
    }
    @media print {
      button, textarea {
        display: none;
      }
    }
  </style>
</head>	
<style>
body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
}

button {
  z-index: 1000;
}
  @media print {
  body * {
    display: none !important;
  }

  .printable, .printable * {
    display: block !important;
  }

  .printable {
    position: absolute;
    top: 0;
    left: 0;
  }
}
</style>	
<!-- Bouton d'impression -->
<button onclick="window.print()" style="position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 10px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
  ğŸ–¨ï¸ Imprimer
</button>
<body>
<div class="printable">
  <div id="originalText"></div>
  <div id="phoneticText" contenteditable="true" style="border: 1px solid #ccc; padding: 5px;"></div>
  <div id="imageLine"></div>
</div>
  <div id="inputArea">
    <h2>Texte Ã  transcrire</h2>
    <textarea id="userInput" rows="4" cols="80" placeholder="Saisissez votre texte ici..."></textarea><br>
    <button onclick="transcrireTexte()">Transcrire</button>
  </div>

  <div id="outputArea">
    <h2>Transcription en images LPC</h2>
    <div id="originalText"></div>
    <div id="phoneticText" contenteditable="true" style="border: 1px solid #ccc; padding: 5px;"></div>
<small>ğŸ”§ Vous pouvez corriger la transcription en cliquant dessus.</small>
<button onclick="majImagesDepuisTexte()">Mettre Ã  jour les images</button>
    <div id="imageLine"></div>
  </div>

  <script>
  const mapping = {
  "1": ["my", "me", "ty", "te", "fy", "fe", "mÅ“Ìƒ", "tÅ“Ìƒ", "fÅ“Ìƒ"],
  "2": ["py", "pe", "dy", "de", "Ê’y", "Ê’e", "pÅ“Ìƒ", "dÅ“Ìƒ", "Ê’Å“Ìƒ"],
  "3": ["by", "be", "ny", "ne", "É¥y", "É¥e", "bÅ“Ìƒ", "nÅ“Ìƒ", "É¥Å“Ìƒ"],
  "4": ["ly", "le", "Êƒy", "Êƒe", "É²y", "É²e", "wy", "we", "lÅ“Ìƒ", "ÊƒÅ“Ìƒ", "É²Å“Ìƒ"],
  "5": ["ky", "ke", "vy", "ve", "zy", "ze", "kÅ“Ìƒ", "vÅ“Ìƒ", "zÅ“Ìƒ"],
  "6": ["sy", "se", "Ê€y", "Ê€e", "sÅ“Ìƒ"],
  "7": ["É¡y", "É¡e", "É¡Å“Ìƒ"],
  "8": ["jy", "je", "jÅ“Ìƒ", "Å‹y", "Å‹e", "Å‹Å“Ìƒ"],
  "9": ["mÉ›", "mu", "mÉ”", "tÉ›", "tu", "tÉ”", "fÉ›", "fu", "fÉ”"],
  "10": ["pÉ›", "pu", "pÉ”", "dÉ›", "du", "dÉ”", "Ê’É›", "Ê’u", "Ê’É”"],
  "11": ["bÉ›", "bu", "bÉ”", "nÉ›", "nu", "nÉ”", "É¥É›", "É¥u", "É¥É”"],
  "12": ["lÉ›", "lu", "lÉ”", "ÊƒÉ›", "Êƒu", "ÊƒÉ”", "É²É›", "É²u", "É²É”", "wÉ›", "wu", "wÉ”"],
  "13": ["kÉ›", "ku", "kÉ”", "vÉ›", "vu", "vÉ”", "zÉ›", "zu", "zÉ”"],
  "14": ["sÉ›", "su", "sÉ”", "Ê€É›", "Ê€u", "Ê€É”"],
  "15": ["É¡É›", "É¡u", "É¡É”"],
  "16": ["jÉ›", "ju", "jÉ”", "Å‹É›", "Å‹u", "Å‹É”"],
  "17": ["mi", "mÉ”Ìƒ", "mÉ‘Ìƒ", "ti", "tÉ”Ìƒ", "tÉ‘Ìƒ", "fi", "fÉ”Ìƒ", "fÉ‘Ìƒ"],
  "18": ["pi", "pÉ”Ìƒ", "pÉ‘Ìƒ", "di", "dÉ”Ìƒ", "dÉ‘Ìƒ", "Ê’i", "Ê’É”Ìƒ", "Ê’É‘Ìƒ"],
  "19": ["bi", "bÉ”Ìƒ", "bÉ‘Ìƒ", "ni", "nÉ”Ìƒ", "nÉ‘Ìƒ", "É¥i", "É¥É”Ìƒ", "É¥É‘Ìƒ"],
  "20": ["li", "lÉ”Ìƒ", "lÉ‘Ìƒ", "Êƒi", "ÊƒÉ”Ìƒ", "ÊƒÉ‘Ìƒ", "É²i", "É²É”Ìƒ", "É²É‘Ìƒ", "wi", "wÉ”Ìƒ", "wÉ‘Ìƒ"],
  "21": ["ki", "kÉ”Ìƒ", "kÉ‘Ìƒ", "vi", "vÉ”Ìƒ", "vÉ‘Ìƒ", "zi", "zÉ”Ìƒ", "zÉ‘Ìƒ"],
  "22": ["si", "sÉ”Ìƒ", "sÉ‘Ìƒ", "Ê€i", "Ê€É”Ìƒ", "Ê€É‘Ìƒ"],
  "23": ["É¡i", "É¡É”Ìƒ", "É¡É‘Ìƒ"],
  "24": ["ji", "jÉ”Ìƒ", "jÉ‘Ìƒ", "Å‹i", "Å‹É”Ìƒ", "Å‹É‘Ìƒ"],
  "25": ["ma", "mo", "mÅ“", "ta", "to", "tÅ“", "fa", "fo", "fÅ“"],
  "26": ["pa", "po", "pÅ“", "da", "do", "dÅ“", "Ê’a", "Ê’o", "Ê’Å“"],
  "27": ["ba", "bo", "bÅ“", "na", "no", "nÅ“", "É¥a", "É¥o", "É¥Å“"],
  "28": ["la", "lo", "lÅ“", "Êƒa", "Êƒo", "ÊƒÅ“", "É²a", "É²o", "É²Å“", "wa", "wo", "wÅ“"],
  "29": ["ka", "ko", "kÅ“", "va", "vo", "vÅ“", "za", "zo", "zÅ“"],
  "30": ["sa", "so", "sÅ“", "Ê€a", "Ê€o", "Ê€Å“"],
  "31": ["É¡a", "É¡o", "É¡Å“"],
  "32": ["ja", "jo", "jÅ“", "Å‹a", "Å‹o", "Å‹Å“"],
  "33": ["mÉ›Ìƒ", "mÃ¸", "mÉ™", "tÉ›Ìƒ", "tÃ¸", "tÉ™", "fÉ›Ìƒ", "fÃ¸", "fÉ™"],
  "34": ["pÉ›Ìƒ", "pÃ¸", "pÉ™", "dÉ›Ìƒ", "dÃ¸", "dÉ™", "Ê’É›Ìƒ", "Ê’Ã¸", "Ê’É™"],
  "35": ["bÉ›Ìƒ", "bÃ¸", "bÉ™", "nÉ›Ìƒ", "nÃ¸", "nÉ™", "É¥É›Ìƒ", "É¥Ã¸", "É¥É™"],
  "36": ["lÉ›Ìƒ", "lÃ¸", "lÉ™", "ÊƒÉ›Ìƒ", "ÊƒÃ¸", "ÊƒÉ™", "É²É›Ìƒ", "É²Ã¸", "É²É™", "wÉ›Ìƒ", "wÃ¸", "wÉ™"],
  "37": ["kÉ›Ìƒ", "kÃ¸", "kÉ™", "vÉ›Ìƒ", "vÃ¸", "vÉ™", "zÉ›Ìƒ", "zÃ¸", "zÉ™"],
  "38": ["sÉ›Ìƒ", "sÃ¸", "sÉ™", "Ê€É›Ìƒ", "Ê€Ã¸", "Ê€É™"],
  "39": ["É¡É›Ìƒ", "É¡Ã¸", "É¡É™"],
  "40": ["jÉ›Ìƒ", "jÃ¸", "jÉ™", "Å‹É›Ìƒ", "Å‹Ã¸", "Å‹É™"],
  "A": ["y", "e", "Å“Ìƒ"],
  "B": ["É›", "u", "É”"],
  "C": ["i", "É”Ìƒ", "É‘Ìƒ"],
  "D": ["a", "o", "Å“"],
  "E": ["É›Ìƒ", "Ã¸", "É™"],
  "F": ["m", "t", "f"],
  "G": ["p", "d", "Ê’"],
  "H": ["b", "n", "É¥"],
  "I": ["l", "Êƒ", "É²", "w"],
  "J": ["k", "v", "z"],
  "K": ["s", "Ê€"],
  "L": ["É¡"],
  "M": ["j", "Å‹"]
};

    async function transcrireTexte() {
    const texte = document.getElementById("userInput").value;
    if (!texte.trim()) return;

    document.getElementById("originalText").innerText = texte;
    document.getElementById("imageLine").innerHTML = "";
    document.getElementById("phoneticText").innerText = "";

    const response = await fetch("http://127.0.0.1:5000/transcrire", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ texte })
    });

    const data = await response.json();
    let phonemes = data.phonemes;

    // Affiche la transcription phonÃ©tique
    document.getElementById("phoneticText").innerText = phonemes;

    // Nettoyage
    phonemes = phonemes.replace(/[\s-]/g, "").replace(/Ë/g, "");

    afficherImagesDepuisPhonemes(phonemes);
  }

  function majImagesDepuisTexte() {
    const phoneticText = document.getElementById("phoneticText").innerText;
    if (!phoneticText.trim()) return;

    const phonemes = phoneticText.replace(/[\s-]/g, "").replace(/Ë/g, "").replace(/Ê/g, "Ê€");

    afficherImagesDepuisPhonemes(phonemes);
  }

  function afficherImagesDepuisPhonemes(phonemes) {
  // Normalisation des phonÃ¨mes (Ê traitÃ© comme r)
  phonemes = phonemes.replace(/Ê/g, "Ê€");


  const resultImages = [];
  const resultPhonemes = [];
  let i = 0;
  const maxPhonemeLength = 3;

    while (i < phonemes.length) {
      let match = false;
      for (let len = maxPhonemeLength; len > 0; len--) {
        const segment = phonemes.slice(i, i + len);
        for (const [img, list] of Object.entries(mapping)) {
          if (list.includes(segment)) {
            resultImages.push(`${img}.png`);
            resultPhonemes.push(segment);
            i += len;
            match = true;
            break;
          }
        }
        if (match) break;
      }
      if (!match) {
        i++;
      }
    }

    const imageLine = document.getElementById("imageLine");
    imageLine.innerHTML = "";

    resultImages.forEach((img, index) => {
      const container = document.createElement("div");
      container.style.display = "flex";
      container.style.flexDirection = "column";
      container.style.alignItems = "center";
      container.style.fontSize = "14px";
      container.style.margin = "4px";

      const imageElement = document.createElement("img");
      imageElement.src = `http://127.0.0.1:5000/images/${img}`;
      imageElement.style.height = "100px";

      const phonemeText = document.createElement("span");
      phonemeText.innerText = resultPhonemes[index] || "";

      container.appendChild(imageElement);
      container.appendChild(phonemeText);
      imageLine.appendChild(container);
    });
  }
</script>
